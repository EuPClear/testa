-- EUP HUB - ESP & Aimbot com Abas, Minimizar (Shift Direito), RGB Título
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESPEnabled = false
local AimbotEnabled = false
local ESPBoxes = {}
local ESPNames = {}
local ESPColor = Color3.fromRGB(255, 80, 80)
local NameColor = Color3.fromRGB(255, 255, 255)
local FOVSize = 150
local BoxSizeMultiplier = 1
local HubVisible = true

-- Criar círculo FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(85, 170, 255)
FOVCircle.Thickness = 1
FOVCircle.NumSides = 100
FOVCircle.Radius = FOVSize
FOVCircle.Filled = false
FOVCircle.Visible = false

-- Criar Interface Principal
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "EUP_HUB"

defaultFont = Enum.Font.GothamBold

local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 300, 0, 280)
mainFrame.Position = UDim2.new(0, 20, 0, 50)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame)
Instance.new("UIStroke", mainFrame).Color = Color3.fromRGB(85, 170, 255)

-- Título RGB
local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "EUP HUB"
title.TextColor3 = Color3.fromRGB(255,0,0)
title.Font = defaultFont
title.TextSize = 20
title.BackgroundTransparency = 1

-- Abas
local tabButtons = Instance.new("Frame", mainFrame)
tabButtons.Size = UDim2.new(1, 0, 0, 30)
tabButtons.Position = UDim2.new(0, 0, 0, 30)
tabButtons.BackgroundTransparency = 1

local contentFrame = Instance.new("Frame", mainFrame)
contentFrame.Size = UDim2.new(1, 0, 1, -60)
contentFrame.Position = UDim2.new(0, 0, 0, 60)
contentFrame.BackgroundTransparency = 1

local function createTab(name)
    local tab = Instance.new("Frame", contentFrame)
    tab.Name = name
    tab.Size = UDim2.new(1, 0, 1, 0)
    tab.Visible = false
    tab.BackgroundTransparency = 1
    return tab
end

local function createTabButton(name, tab)
    local btn = Instance.new("TextButton", tabButtons)
    btn.Size = UDim2.new(0, 100, 1, 0)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function()
        for _, c in pairs(contentFrame:GetChildren()) do
            if c:IsA("Frame") then c.Visible = false end
        end
        tab.Visible = true
    end)
end

-- Utilitários UI
local function createButton(parent, text, yPos, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0.9, 0, 0, 30)
    btn.Position = UDim2.new(0.05, 0, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    btn.Text = text
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(callback)
end

local function createColorPicker(parent, yPos, name, defaultColor, onColorChanged)
    local label = Instance.new("TextLabel", parent)
    label.Size = UDim2.new(0.5, 0, 0, 25)
    label.Position = UDim2.new(0.05, 0, 0, yPos)
    label.Text = name
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextColor3 = Color3.new(1,1,1)
    label.BackgroundTransparency = 1

    local box = Instance.new("TextBox", parent)
    box.Size = UDim2.new(0.4, 0, 0, 25)
    box.Position = UDim2.new(0.55, 0, 0, yPos)
    box.Text = string.format("%d,%d,%d", defaultColor.R*255, defaultColor.G*255, defaultColor.B*255)
    box.Font = Enum.Font.Code
    box.TextSize = 14
    box.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    box.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", box)

    box.FocusLost:Connect(function()
        local r,g,b = box.Text:match("(%d+),(%d+),(%d+)")
        if r and g and b then
            local c = Color3.fromRGB(tonumber(r), tonumber(g), tonumber(b))
            onColorChanged(c)
        end
    end)
end

local function createSlider(parent, yPos, labelText, defaultValue, min, max, onChanged)
    local label = Instance.new("TextLabel", parent)
    label.Size = UDim2.new(1, -10, 0, 20)
    label.Position = UDim2.new(0.05, 0, 0, yPos)
    label.Text = labelText
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.BackgroundTransparency = 1

    local slider = Instance.new("TextBox", parent)
    slider.Size = UDim2.new(0.9, 0, 0, 25)
    slider.Position = UDim2.new(0.05, 0, 0, yPos + 20)
    slider.Text = tostring(defaultValue)
    slider.Font = Enum.Font.Code
    slider.TextSize = 14
    slider.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    slider.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", slider)

    slider.FocusLost:Connect(function()
        local new = tonumber(slider.Text)
        if new then
            new = math.clamp(new, min, max)
            onChanged(new)
        end
    end)
end

-- ESP TAB
local espTab = createTab("ESP")
createTabButton("ESP", espTab)
createButton(espTab, "Ativar ESP", 10, function()
    ESPEnabled = not ESPEnabled
    for _, p in pairs(Players:GetPlayers()) do
        if not ESPBoxes[p] then
            createESPBox(p)
        end
    end
end)
createColorPicker(espTab, 50, "Cor Box", ESPColor, function(newColor) ESPColor = newColor end)
createColorPicker(espTab, 80, "Cor Nome", NameColor, function(newColor) NameColor = newColor end)
createSlider(espTab, 110, "Tamanho Box", BoxSizeMultiplier, 0.1, 3, function(val) BoxSizeMultiplier = val end)

-- Aimbot TAB
local aimTab = createTab("Aimbot")
createTabButton("Aimbot", aimTab)
createButton(aimTab, "Ativar Aimbot", 10, function()
    AimbotEnabled = not AimbotEnabled
    FOVCircle.Visible = AimbotEnabled
end)
createSlider(aimTab, 50, "FOV", FOVSize, 50, 500, function(val)
    FOVSize = val
    FOVCircle.Radius = val
end)

-- ESP Funcionalidade
function createESPBox(player)
    if player == LocalPlayer or player.Team == LocalPlayer.Team then return end
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Filled = false
    box.Color = ESPColor
    box.Visible = true
    ESPBoxes[player] = box

    local name = Drawing.new("Text")
    name.Size = 13
    name.Color = NameColor
    name.Center = true
    name.Outline = true
    name.Visible = true
    ESPNames[player] = name
end

function updateESP()
    for player, box in pairs(ESPBoxes) do
        local char = player.Character
        local name = ESPNames[player]
        if ESPEnabled and char and char:FindFirstChild("HumanoidRootPart") then
            local pos, onScreen = Camera:WorldToViewportPoint(char.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Camera.CFrame.Position - char.HumanoidRootPart.Position).Magnitude
                local scale = BoxSizeMultiplier * (1000 / distance)
                box.Size = Vector2.new(30, 50) * scale
                box.Position = Vector2.new(pos.X - box.Size.X/2, pos.Y - box.Size.Y/2)
                box.Color = ESPColor
                box.Visible = true

                name.Text = player.Name
                name.Position = Vector2.new(pos.X, pos.Y - (box.Size.Y/2 + 14))
                name.Color = NameColor
                name.Visible = true
            else
                box.Visible = false
                name.Visible = false
            end
        else
            box.Visible = false
            name.Visible = false
        end
    end
end

function getClosestInFOV()
    local closest, shortest = nil, math.huge
    local mousePos = UserInputService:GetMouseLocation()
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild("Head") then
            local headPos, onScreen = Camera:WorldToViewportPoint(p.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(headPos.X, headPos.Y) - Vector2.new(mousePos.X, mousePos.Y)).Magnitude
                if dist < FOVSize and dist < shortest then
                    shortest = dist
                    closest = p
                end
            end
        end
    end
    return closest
end

-- Atualização contínua
RunService.RenderStepped:Connect(function()
    if not HubVisible then return end
    updateESP()
    local mouse = UserInputService:GetMouseLocation()
    FOVCircle.Position = Vector2.new(mouse.X, mouse.Y)

    if AimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local target = getClosestInFOV()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character.Head.Position)
        end
    end
end)

-- Eventos de Jogadores
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function()
        wait(1)
        if ESPEnabled then
            createESPBox(p)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(p)
    if ESPBoxes[p] then ESPBoxes[p]:Remove() ESPBoxes[p] = nil end
    if ESPNames[p] then ESPNames[p]:Remove() ESPNames[p] = nil end
end)

-- Tecla para ocultar/mostrar GUI
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        HubVisible = not HubVisible
        gui.Enabled = HubVisible
        FOVCircle.Visible = AimbotEnabled and HubVisible
    end
end)

-- RGB no título
local hue = 0
spawn(function()
    while true do
        hue = (hue + 1) % 360
        local color = Color3.fromHSV(hue/360, 1, 1)
        title.TextColor3 = color
        wait(0.03)
    end
end)

-- Mostrar ESP inicialmente invisível
for _, p in pairs(Players:GetPlayers()) do
    if p ~= LocalPlayer then createESPBox(p) end
end
